+++
date = '2026-01-11T12:00:00+08:00'
draft = false
title = 'Linux è¿ç»´å®æˆ˜ï¼šä»é›¶æ„å»º Arch Linux ç”Ÿäº§ç¯å¢ƒ'
tags = ["Linux", "Arch", "DevOps", "Kernel"]
series = ["Arch Linux å®æˆ˜ç¬”è®°"]
summary = "æŠ›å¼ƒå›¾å½¢åŒ–å®‰è£…å™¨ï¼Œæ·±å…¥ç†è§£ Linux ç³»ç»Ÿçš„å¯åŠ¨æµç¨‹ä¸ç»„ä»¶æ„æˆã€‚æœ¬æ–‡è®°å½•äº†ä¸€æ¬¡æ ‡å‡†çš„ Arch Linux æ‰‹åŠ¨æ„å»ºè¿‡ç¨‹ï¼ŒåŒ…å«ç£ç›˜åˆ†åŒºç­–ç•¥ã€å†…æ ¸å®‰è£…åŠ GRUB å¼•å¯¼é…ç½®ã€‚"
+++

> **å†™åœ¨å‰é¢**ï¼š
> Arch Linux çš„æ‰‹åŠ¨å®‰è£…è¿‡ç¨‹æ˜¯ç†è§£ Linux å‘è¡Œç‰ˆæ„æˆï¼ˆKernel, Userland, Bootloaderï¼‰çš„ç»ä½³å®è·µã€‚
> æœ¬æ–‡åŸºäºå®æˆ˜ç¯å¢ƒï¼ˆGNOME Boxes / ISOï¼‰ï¼Œè®°å½•äº†ä»è£¸é‡‘å±ç¯å¢ƒåˆ°æœ€å°åŒ–å¯ç”¨ç³»ç»Ÿçš„å®Œæ•´æ„å»ºæµç¨‹ã€‚

---

## ğŸŸ¢ Phase 1ï¼šç¯å¢ƒåˆå§‹åŒ– (Infrastructure)

åœ¨å¼€å§‹è§¦ç¢°ç£ç›˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿â€œæ•‘æ´ç¯å¢ƒâ€æœ¬èº«æ˜¯å¥åº·ä¸”ç½‘ç»œé€šç•…çš„ã€‚

### 1. ç½‘ç»œè¿é€šæ€§æ£€æŸ¥

æ‹¿åˆ°ä¸€å°æ–°æœåŠ¡å™¨æˆ–æ’æŸ¥æ•…éšœæ—¶ï¼Œç¬¬ä¸€ä»¶äº‹æ°¸è¿œæ˜¯æ£€æŸ¥ç½‘ç»œã€‚

```bash
ping -c 3 baidu.com
```

**ç»“æœåˆ†æï¼š**

* âœ… **æ­£å¸¸**ï¼šæ˜¾ç¤º `64 bytes from ...`ï¼Œè¯´æ˜ DNS è§£ææ­£å¸¸ï¼Œç½‘å¡å·²è·å– IPã€‚
* âŒ **å¼‚å¸¸**ï¼šæ˜¾ç¤º `Temporary failure in name resolution`ï¼Œé€šå¸¸æ„å‘³ç€ DNS è§£æå¤±è´¥æˆ–ç½‘å¡æœªå¯åŠ¨ã€‚

> **ğŸ’¡ Troubleshooting**ï¼š
> å¦‚æœç½‘ç»œä¸é€šï¼Œåœ¨ Arch ISO ç¯å¢ƒä¸‹å¯å°è¯•æ‰‹åŠ¨å¯åŠ¨ç½‘ç»œç®¡ç†å™¨ï¼š
> `systemctl start NetworkManager`

### 2. ç£ç›˜åˆ†åŒºè§„åˆ’


**æ ¸å¿ƒå·¥å…·**ï¼š`lsblk` (æŸ¥çœ‹), `cfdisk` (å›¾å½¢åŒ–åˆ†åŒº)ã€‚

#### Step 1: æ£€æŸ¥ç£ç›˜çŠ¶æ€

```bash
lsblk
```

åœ¨æ“ä½œå‰ï¼ŒåŠ¡å¿…ç¡®è®¤ç¡¬ç›˜è®¾å¤‡åï¼ˆå¦‚ `/dev/vda` æˆ– `/dev/sda`ï¼‰ï¼Œé˜²æ­¢è¯¯æ ¼ç›˜ã€‚æ­¤æ—¶åº”è¯¥çœ‹åˆ°ä¸€ä¸ªå¹²å‡€çš„ `disk` è®¾å¤‡ï¼Œæ²¡æœ‰ä»»ä½• `part` åˆ†æ”¯ã€‚

#### Step 2: æ‰§è¡Œåˆ†åŒº (GPT æ–¹æ¡ˆ)

é‡‡ç”¨ç°ä»£æœåŠ¡å™¨æ ‡å‡†çš„ **GPT åˆ†åŒºè¡¨**ï¼ˆé…åˆ UEFI å¯åŠ¨ï¼‰ã€‚

```bash
cfdisk /dev/vda
```

**åˆ†åŒºæ–¹æ¡ˆå¦‚ä¸‹ï¼š**

| åˆ†åŒº | å®¹é‡ | ç±»å‹ | ä½œç”¨ |
| --- | --- | --- | --- |
| **vda1** | 512M | EFI System | **å¼•å¯¼åŒº**ã€‚å­˜æ”¾ GRUB å’Œå†…æ ¸é•œåƒï¼ŒUEFI å›ºä»¶åªè®¤å®ƒã€‚ |
| **vda2** | 2G | Linux swap | **äº¤æ¢åˆ†åŒº**ã€‚é˜²æ­¢å†…å­˜æº¢å‡º (OOM) å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ |
| **vda3** | å‰©ä½™ | Linux filesystem | **æ ¹åˆ†åŒº (/)**ã€‚å­˜æ”¾ç³»ç»Ÿæ–‡ä»¶ä¸ç”¨æˆ·æ•°æ®ã€‚ |

> **âš ï¸ æ³¨æ„**ï¼šæ“ä½œå®Œæˆåï¼ŒåŠ¡å¿…é€‰æ‹© `[ Write ]` å¹¶è¾“å…¥ `yes` å†™å…¥æ›´æ”¹ï¼Œå¦åˆ™ä¸€åˆ‡æ“ä½œä»…åœç•™åœ¨å†…å­˜ä¸­ã€‚

#### Step 3: æ ¼å¼åŒ–ä¸æŒ‚è½½

æœ‰äº†â€œåˆ†åŒºâ€ï¼Œè¿˜éœ€è¦â€œæ–‡ä»¶ç³»ç»Ÿâ€ã€‚

```bash
# 1. å¼•å¯¼åˆ†åŒº -> å¿…é¡» FAT32 (UEFI è§„èŒƒå¼ºåˆ¶è¦æ±‚)
mkfs.fat -F32 /dev/vda1

# 2. äº¤æ¢åˆ†åŒº -> åˆå§‹åŒ–å¹¶å¯ç”¨
mkswap /dev/vda2
swapon /dev/vda2

# 3. æ ¹åˆ†åŒº -> ä½¿ç”¨ EXT4 (æœ€ç¨³å¥çš„ Linux æ–‡ä»¶ç³»ç»Ÿ)
mkfs.ext4 /dev/vda3
```

**æŒ‚è½½é¡ºåºï¼š** å¿…é¡»éµå¾ª **å…ˆæ ¹åå­** çš„é¡ºåºã€‚

```bash
mount /dev/vda3 /mnt          # 1. å…ˆæŒ‚æ ¹ç›®å½•
mkdir /mnt/boot               # 2. å†å»ºæŒ‚è½½ç‚¹
mount /dev/vda1 /mnt/boot     # 3. æœ€åæŒ‚å¼•å¯¼åˆ†åŒº
```

---

## ğŸŸ¡ Phase 2ï¼šæ ¸å¿ƒç³»ç»Ÿæ„å»º (System Build)

### 3. é•œåƒæºä¼˜åŒ–

é»˜è®¤çš„æºåœ¨æµ·å¤–ï¼Œé€Ÿåº¦å¯èƒ½ææ…¢ã€‚ä¸ºäº†ä¿è¯ç”Ÿäº§æ•ˆç‡ï¼Œéœ€è¦é…ç½®å›½å†…é•œåƒã€‚

ç¼–è¾‘ `/etc/pacman.d/mirrorlist`ï¼Œå°†ä»¥ä¸‹æºç½®é¡¶ï¼š

```bash
Server = [https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch](https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch)
Server = [https://mirrors.aliyun.com/archlinux/$repo/os/$arch](https://mirrors.aliyun.com/archlinux/$repo/os/$arch)
```

*ä¿®æ”¹åè®°å¾—æ‰§è¡Œ `pacman -Syy` å¼ºåˆ¶åˆ·æ–°æ•°æ®åº“ã€‚*

### 4. åŸºç¡€ç³»ç»Ÿå®‰è£… (Pacstrap)

è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œéœ€è¦å‘ç©ºç¡¬ç›˜ä¸­çŒå…¥æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚

```bash
pacstrap -K /mnt base linux linux-firmware vim networkmanager sudo man-db
```

**ç»„ä»¶è§£æï¼š**

* `linux` & `firmware`: ä¹Ÿå°±æ˜¯ Kernelã€‚æ²¡æœ‰ Firmwareï¼Œç½‘å¡å’Œæ˜¾å¡å¯èƒ½æ— æ³•å·¥ä½œã€‚
* `vim`: ç³»ç»Ÿè£…å¥½åï¼Œå¿…é¡»æœ‰ç¼–è¾‘å™¨æ¥ä¿®æ”¹é…ç½®ï¼ˆè¿ç»´çš„æ‰‹æœ¯åˆ€ï¼‰ã€‚
* `networkmanager`: æä¾› `nmcli`ï¼Œæ–¹ä¾¿åç»­ç®¡ç†ç½‘ç»œã€‚

### 5. ç”Ÿæˆ fstab å¹¶åˆ‡æ¢ç¯å¢ƒ

**Fstab (File System Table)** å‘Šè¯‰ Linux å†…æ ¸å¼€æœºæ—¶æ¯ä¸ªåˆ†åŒºè¯¥æŒ‚è½½åˆ°å“ªé‡Œã€‚å¦‚æœä¸ç”Ÿæˆï¼Œé‡å¯åç³»ç»Ÿå°†æ‰¾ä¸åˆ°ç¡¬ç›˜ã€‚

```bash
genfstab -U /mnt >> /mnt/etc/fstab
```

**æ£€æŸ¥ç‚¹**ï¼šæ‰§è¡Œ `cat /mnt/etc/fstab`ï¼Œç¡®ä¿èƒ½å¤Ÿçœ‹åˆ° `UUID=... / ext4` å’Œ `UUID=... /boot vfat` çš„è®°å½•ã€‚æ¨èä½¿ç”¨ **UUID** æŒ‚è½½ï¼Œé˜²æ­¢æ’æ‹”ç¡¬ç›˜å¯¼è‡´ç›˜ç¬¦æ¼‚ç§»ã€‚

æœ€åï¼Œç©¿è¶Šè¿›å…¥æ–°ç³»ç»Ÿï¼š

```bash
arch-chroot /mnt
```

---

## ğŸ”µ Phase 3ï¼šç³»ç»Ÿæ ¸å¿ƒé…ç½® (Configuration)

è¿›å…¥ Chroot ç¯å¢ƒåï¼Œç›¸å½“äºå·²ç»åœ¨äº†æ–°ç³»ç»Ÿå†…éƒ¨ã€‚ç°åœ¨éœ€è¦ç¡®ç«‹å®ƒçš„â€œèº«ä»½â€ã€‚

### 6. èº«ä»½ä¸æ—¶åŒº

```bash
# 1. è®¾ç½®æ—¶åŒº (ä¸Šæµ·)
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock --systohc

# 2. æœ¬åœ°åŒ–è®¾ç½®
# ç¼–è¾‘ /etc/locale.gen å–æ¶ˆ en_US.UTF-8 å’Œ zh_CN.UTF-8 çš„æ³¨é‡Šï¼Œç„¶åæ‰§è¡Œï¼š
locale-gen
echo "LANG=en_US.UTF-8" > /etc/locale.conf

# 3. è®¾ç½®ä¸»æœºå
echo "username@arch" > /etc/hostname

# 4. è®¾ç½® Root å¯†ç 
passwd
```

### 7. å¼•å¯¼ç¨‹åºå®‰è£… (GRUB)

è¿™æ˜¯å†³å®šç”µè„‘å¼€æœºèƒ½å¦æ‰¾åˆ° Linux çš„æœ€åä¸€æ­¥ã€‚

```bash
# å®‰è£… GRUB åˆ° EFI åˆ†åŒº
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB

# ç”Ÿæˆé…ç½®æ–‡ä»¶
grub-mkconfig -o /boot/grub/grub.cfg
```

**éªŒæ”¶æ ‡å‡†**ï¼š
çœ‹åˆ° `Found linux image: /boot/vmlinuz-linux` å’Œ `Found initrd image`ï¼Œè¯´æ˜ GRUB æˆåŠŸæ‰«æåˆ°äº†æˆ‘ä»¬åˆšæ‰å®‰è£…çš„å†…æ ¸ã€‚

---

## ğŸ Phase 4ï¼šæ”¶å°¾ä¸é‡å¯

æ­å–œï¼Œç³»ç»Ÿæ„å»ºå®Œæˆã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä¼˜é›…åœ°é€€å‡ºã€‚

1. **é€€å‡º Chroot**ï¼š`exit`
2. **å¸è½½åˆ†åŒº**ï¼š`umount -R /mnt` (ç¡®ä¿æ•°æ®å®Œå…¨å†™å…¥ç£ç›˜)
3. **é‡å¯**ï¼š`reboot`

æ‹”æ‰å®‰è£…ä»‹è´¨ï¼Œè¿æ¥ä½ çš„å…¨æ–° Arch Linux å§ï¼ğŸ§
